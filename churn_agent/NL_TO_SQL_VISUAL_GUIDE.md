# Natural Language to SQL RAG - Visual Guide

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                               â”‚
â”‚                     (Streamlit Web App)                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Text Input Box â”‚  â”‚ Example Queries â”‚  â”‚  Schema Viewer    â”‚   â”‚
â”‚  â”‚ "How many      â”‚  â”‚ - Count         â”‚  â”‚  - account_id     â”‚   â”‚
â”‚  â”‚  customers?"   â”‚  â”‚ - Revenue       â”‚  â”‚  - mrr_amount     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - Churn rate    â”‚  â”‚  - plan_tier      â”‚   â”‚
â”‚           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              Execute Query Button                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NL-TO-SQL RAG ENGINE                              â”‚
â”‚                   (nl_to_sql_rag.py)                                 â”‚
â”‚                                                                      â”‚
â”‚  Step 1: PREPROCESSING                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ "How many customers do we have?"                        â”‚        â”‚
â”‚  â”‚      â†“ Clean & normalize                                â”‚        â”‚
â”‚  â”‚ "how many customers do we have"                         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                                                  â”‚
â”‚  Step 2: VECTORIZATION (TF-IDF)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ User Query â†’ [0.23, 0.45, 0.12, ..., 0.67]             â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚ Template 1: "how many customers" â†’ [0.89, 0.12, ...]   â”‚        â”‚
â”‚  â”‚ Template 2: "total revenue" â†’ [0.05, 0.78, ...]        â”‚        â”‚
â”‚  â”‚ Template 3: "churn rate" â†’ [0.11, 0.34, ...]           â”‚        â”‚
â”‚  â”‚ ... (16 templates total)                                â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                                                  â”‚
â”‚  Step 3: SIMILARITY MATCHING (Cosine Similarity)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Compare user vector with all template vectors           â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚ Template 1: 90.53% match âœ“ BEST MATCH                  â”‚        â”‚
â”‚  â”‚ Template 2: 23.45% match                                â”‚        â”‚
â”‚  â”‚ Template 3: 15.67% match                                â”‚        â”‚
â”‚  â”‚ ...                                                      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                                                  â”‚
â”‚  Step 4: ENTITY EXTRACTION                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Scan query for:                                         â”‚        â”‚
â”‚  â”‚ - Numbers: $1000, 500, 1,234.56                        â”‚        â”‚
â”‚  â”‚ - Plan types: basic, premium, enterprise               â”‚        â”‚
â”‚  â”‚ - Dates: "this month", "last 30 days"                  â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚ Found: {} (no parameters for this query)               â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                                                  â”‚
â”‚  Step 5: SQL GENERATION                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Template SQL:                                           â”‚        â”‚
â”‚  â”‚ "SELECT COUNT(DISTINCT account_id)                      â”‚        â”‚
â”‚  â”‚  FROM `{table_ref}`"                                    â”‚        â”‚
â”‚  â”‚      â†“ Populate variables                               â”‚        â”‚
â”‚  â”‚ "SELECT COUNT(DISTINCT account_id)                      â”‚        â”‚
â”‚  â”‚  FROM `hackathon-475722.saas.ravenstack_subscriptions`"â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BIGQUERY EXECUTION                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Google Cloud BigQuery                                  â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚        â”‚
â”‚  â”‚  â”‚ Table: hackathon-475722.saas.                â”‚      â”‚        â”‚
â”‚  â”‚  â”‚        ravenstack_subscriptions              â”‚      â”‚        â”‚
â”‚  â”‚  â”‚                                               â”‚      â”‚        â”‚
â”‚  â”‚  â”‚ Rows: 500 subscriptions                      â”‚      â”‚        â”‚
â”‚  â”‚  â”‚ Columns: account_id, mrr_amount, plan_tier  â”‚      â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚        â”‚
â”‚  â”‚                 â”‚ Execute SQL                            â”‚        â”‚
â”‚  â”‚                 â–¼                                        â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚        â”‚
â”‚  â”‚  â”‚ Result: 500 distinct customers                â”‚      â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESULT FORMATTING                                 â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Detect result type:                                     â”‚        â”‚
â”‚  â”‚ - Single value? â†’ Format as metric card                â”‚        â”‚
â”‚  â”‚ - Multiple rows? â†’ Format as table                     â”‚        â”‚
â”‚  â”‚ - Grouped data? â†’ Add chart options                    â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚ Result: Single value (500)                              â”‚        â”‚
â”‚  â”‚ Format: Metric card "Result: 500"                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DISPLAY RESULTS                                   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ âœ… Intent: Count total customers (Confidence: 90%)     â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚ ğŸ”§ Generated SQL:                                       â”‚        â”‚
â”‚  â”‚    SELECT COUNT(DISTINCT account_id)                    â”‚        â”‚
â”‚  â”‚    FROM `hackathon-475722.saas...`                      â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚ ğŸ“Š Results:                                             â”‚        â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚        â”‚
â”‚  â”‚    â”‚  Total Customers    â”‚                             â”‚        â”‚
â”‚  â”‚    â”‚       500           â”‚  â† Large metric card        â”‚        â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚        â”‚
â”‚  â”‚                                                          â”‚        â”‚
â”‚  â”‚ ğŸ“¥ [Download CSV]  [Copy SQL]                          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Query Flow Examples

### Example 1: Simple Count Query

```
USER INPUT: "How many customers do we have?"
    â†“
VECTORIZE: [0.23, 0.45, 0.12, 0.67, ...]
    â†“
MATCH: Template #1 "Count customers" (90.53% confidence)
    â†“
EXTRACT: No entities needed
    â†“
GENERATE SQL: SELECT COUNT(DISTINCT account_id) FROM table
    â†“
EXECUTE: BigQuery returns 500
    â†“
FORMAT: "Result: 500"
    â†“
DISPLAY: Metric card with value
```

### Example 2: Filtered Query with Entity

```
USER INPUT: "Show me customers spending more than $1000"
    â†“
VECTORIZE: [0.15, 0.67, 0.23, 0.89, ...]
    â†“
MATCH: Template #14 "Customers with MRR above threshold" (87.78%)
    â†“
EXTRACT: amount = 1000.0
    â†“
GENERATE SQL: SELECT * FROM table WHERE mrr_amount > 1000 
              ORDER BY mrr_amount DESC
    â†“
EXECUTE: BigQuery returns 45 rows
    â†“
FORMAT: DataFrame with columns [account_id, mrr_amount, plan_tier, ...]
    â†“
DISPLAY: Interactive table + bar chart option
```

### Example 3: Grouped Query with Visualization

```
USER INPUT: "List customers by plan type"
    â†“
VECTORIZE: [0.34, 0.12, 0.78, 0.45, ...]
    â†“
MATCH: Template #8 "Group by plan type" (71.28%)
    â†“
EXTRACT: No entities needed
    â†“
GENERATE SQL: SELECT plan_tier, COUNT(*), SUM(mrr_amount)
              FROM table GROUP BY plan_tier
              ORDER BY SUM(mrr_amount) DESC
    â†“
EXECUTE: BigQuery returns 3 rows:
         Basic: 150 customers, $30,000
         Premium: 200 customers, $80,000
         Enterprise: 150 customers, $90,000
    â†“
FORMAT: DataFrame with aggregated data
    â†“
DISPLAY: Table + Auto-generated bar chart showing revenue by plan
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit UI    â”‚ â† User interacts here
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ calls
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NLtoSQLRAG       â”‚ â† Main RAG engine
â”‚  .process_query()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ uses
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ TfidfVectorizer â”‚ â† Converts text to vectors
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ Cosine Similarityâ”‚ â† Matches templates
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ Entity Extractorâ”‚ â† Finds amounts, plans
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ BigQuery Client â”‚ â† Executes SQL
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query   â”‚ --> â”‚  Vector  â”‚ --> â”‚   SQL    â”‚ --> â”‚  Result  â”‚
â”‚ "How     â”‚     â”‚ [0.23,   â”‚     â”‚ SELECT   â”‚     â”‚   500    â”‚
â”‚  many    â”‚     â”‚  0.45,   â”‚     â”‚ COUNT... â”‚     â”‚          â”‚
â”‚  cust?"  â”‚     â”‚  ...]    â”‚     â”‚          â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                 â”‚                â”‚
     â”‚                â”‚                 â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                â”‚                 â”‚
         Preprocessing   Matching &          Execution &
         & Extraction    Generation          Formatting
```

## Template Matching Visualization

```
User Query: "How many customers?"
      â†“
[Vectorize into 500 dimensions]
      â†“
Compare with 16 templates:

Template 1: "Count customers"
Vector: [0.89, 0.12, 0.34, ...]
Similarity: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 90.53% âœ“ SELECTED

Template 2: "Total revenue"
Vector: [0.05, 0.78, 0.11, ...]
Similarity: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 23.45%

Template 3: "Churn rate"
Vector: [0.11, 0.34, 0.67, ...]
Similarity: â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 15.67%

[... 13 more templates ...]

Best match: Template 1 (Count customers)
Confidence: 90.53%
SQL: SELECT COUNT(DISTINCT account_id) FROM table
```

## Entity Extraction Process

```
Input: "Show me customers spending more than $1,234.56 in premium plan"
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚
    â–¼                    â–¼
[Number Pattern]    [Plan Pattern]
"$1,234.56"         "premium"
    â†“                    â†“
Parse & Clean       Normalize
1234.56             "premium"
    â†“                    â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
Entities: {
  "amount": 1234.56,
  "plan": "premium"
}
              â†“
SQL: SELECT * FROM table 
     WHERE mrr_amount > 1234.56 
     AND LOWER(plan_tier) LIKE '%premium%'
```

## Visualization Selection Logic

```
Query Result
     â†“
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚ Analyze â”‚
â”‚ Result  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ Single value? â”€â”€â†’ Metric Card
     â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                     â”‚   500     â”‚
     â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ Single row, multiple columns? â”€â”€â†’ Multiple Metrics
     â”‚                                     â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
     â”‚                                     â”‚100 â”‚200 â”‚20% â”‚
     â”‚                                     â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ Multiple rows, grouped data? â”€â”€â†’ Bar/Pie Chart
     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                    â”‚ â–“â–“â–“â–“â–“       â”‚
     â”‚                                    â”‚ â–“â–“â–“â–“â–“â–“â–“â–“    â”‚
     â”‚                                    â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“  â”‚
     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â†’ Time series data? â”€â”€â†’ Line Chart
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    â•±â•²  â•±â•²   â”‚
                              â”‚   â•±  â•²â•±  â•²  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Complete User Journey

```
1. User opens Streamlit app
   â†“
2. Clicks "Query Data with Natural Language"
   â†“
3. Sees interface with:
   - Text input box
   - Example queries (clickable)
   - Schema viewer
   â†“
4. Types or clicks: "How many customers?"
   â†“
5. Clicks "Execute Query"
   â†“
6. System shows:
   âœ… Understanding: "Count customers (90% confident)"
   ğŸ”§ SQL: "SELECT COUNT(DISTINCT account_id)..."
   â†“
7. BigQuery executes query
   â†“
8. System shows:
   ğŸ“Š Result: 500 (in large metric card)
   ğŸ“¥ Download button
   â†“
9. User can:
   - Try another query
   - Download results
   - Copy SQL
   - View different visualizations
```

## Error Handling Flow

```
User Query
     â†“
 Valid query?
     â”œâ”€â†’ No â”€â”€â†’ Show error + suggestions
     â”‚         "I couldn't understand..."
     â”‚         Suggestions:
     â”‚         - How many customers?
     â”‚         - What is total revenue?
     â”‚
     â””â”€â†’ Yes â”€â”€â†’ Continue to matching
                      â†“
              High confidence?
                      â”œâ”€â†’ No â”€â”€â†’ Show alternatives
                      â”‚         "Did you mean...?"
                      â”‚
                      â””â”€â†’ Yes â”€â”€â†’ Generate SQL
                                      â†“
                              Parameters complete?
                                      â”œâ”€â†’ No â”€â”€â†’ Ask for params
                                      â”‚         "Please specify amount"
                                      â”‚
                                      â””â”€â†’ Yes â”€â”€â†’ Execute query
                                                      â†“
                                              Query success?
                                                      â”œâ”€â†’ No â”€â”€â†’ Show error
                                                      â”‚         + SQL for debug
                                                      â”‚
                                                      â””â”€â†’ Yes â”€â”€â†’ Show results!
```

---

**This visual guide helps understand the complete flow from user input to result display!** ğŸ¯
